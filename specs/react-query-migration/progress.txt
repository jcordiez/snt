# React Query Migration - Implementation Progress

## Phase 1: Setup Infrastructure
- [x] Install @tanstack/react-query package (v5.90.20)
- [x] Install @tanstack/react-query-devtools (dev dependency, v5.91.2)
- [x] Create /src/lib/query-client.ts with QueryClient configuration
- [x] Create /src/lib/query-keys.ts with query key factory
- [x] Create /src/app/providers.tsx with QueryClientProvider
- [x] Update /src/app/layout.tsx to use Providers

## Phase 2: Migrate Static Data Hooks
- [x] Migrate useOrgUnits hook
  - [x] Replace useEffect/useState with useQuery
  - [x] Preserve geoJson and provinces computed values
  - [x] Preserve updateDistricts callback functionality
  - [x] Test in plan page (build passed)
- [x] Migrate useInterventionCategories hook
  - [x] Replace useEffect/useState with useQuery
  - [x] Verify return type compatibility
  - [x] Test in plan page (build passed)
- [x] Migrate useMetricTypes hook
  - [x] Replace useEffect/useState with useQuery
  - [x] Preserve groupedByCategory computed value (using useMemo)
  - [x] Preserve addMetric callback with local state for client-side metrics
  - [x] Test in plan page and layers page (build passed)

## Phase 3: Migrate Parameterized Hooks
- [x] Migrate useMetricValues hook
  - [x] Replace useEffect/useState with useQuery
  - [x] Use enabled option for null metricTypeId
  - [x] Preserve valuesByOrgUnit, min, max computed values
  - [x] Configure staleTime: 5 minutes
  - [x] Test with build (passed)
- [ ] Migrate useMultipleMetricValues hook
  - [ ] Replace Promise.all with useQueries
  - [ ] Preserve metricValuesByType Map structure
  - [ ] Test parallel fetching behavior
  - [ ] Verify individual error handling works

## Phase 4: Cleanup and Optimization
- [ ] Remove unused imports from migrated hooks
- [ ] Configure staleTime per query type:
  - [ ] orgUnits: Infinity
  - [ ] intervention-categories: Infinity
  - [ ] metric-types: Infinity
  - [ ] metric-values: 5 minutes
- [ ] Add error boundary component for query errors
- [ ] Review and optimize gcTime settings

## Phase 5: Testing and Validation
- [ ] Verify request deduplication (Network tab)
  - [ ] Same metric requested by multiple components = 1 request
  - [ ] Navigate away and back = no refetch (within staleTime)
- [ ] Verify cache population (React Query DevTools)
  - [ ] All query keys visible
  - [ ] Data correctly cached
- [ ] Test error scenarios
  - [ ] Individual metric fetch failure
  - [ ] Network offline behavior
- [ ] Performance validation
  - [ ] Compare initial load time before/after
  - [ ] Verify no memory leaks

## Notes
- useOrgUnits migration uses hybrid approach: useQuery for fetching + useState for mutable GeoJSON data (required for updateDistricts callback)
- useMetricTypes migration uses hybrid approach: useQuery for fetching + useState for locally added metrics (required for addMetric callback)

## Issues Encountered
-

## Completion Date
- Phase 1: 2026-01-28
- Phase 2: 2026-01-28
- Phase 3:
- Phase 4:
- Phase 5:
- Full Migration:
